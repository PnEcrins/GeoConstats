{% extends "base.html" %}

{% block content %}
<div id="bloc">
<div id="map"></div>
<div class="leftMap">

    <center><h1>Ajouter un constat</h1></center>
	<form action="{{url_for('routes.add')}}" method="post" novalidate>
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <ul class="alert alert-danger">
            Les champs suivants sont requis ou incorrects
            {% for message in messages %}
                {% for field, reason in message.items() %}
                    <li>{{ field }}</li>
                {% endfor %}
            {% endfor %}
            </ul>
        {% endif %}
        {% endwith %}
            {{ form.hidden_tag() }}
        <div class="form-group">
            Date de l'attaque *<br>
            {{ form.date_attaque(
                size=18, placeholder='dd/mm/aaaa',required='required', class_="form-control"
                ) }}
        </div>
        <div class="form-group">
            Date du constat <br>
            {{ form.date_constat(size=18, placeholder='dd/mm/aaaa',required='required', class_="form-control") }}
        </div>
        <div class="form-group">
            Nom du premier agent <br>
            {{ form.nom_agent1(size=18, placeholder='Prénom Nom', class_="form-control") }}
        </div>
        <div class="form-group">
            Nom du deuxième agent <br>
            {{ form.nom_agent2(size=18,placeholder='Prénom Nom', class_="form-control") }}
        </div>
        <div class="form-group">
            Propriétaire <br>
            {{ form.proprietaire(size=18,placeholder='Prénom Nom', class_="form-control") }}
        </div>
        <div class="form-group">
            Type d'animaux <br>
            {{ form.type_animaux(size=1, class_="form-control") }}
        </div>		
        <div class="form-group">
            Nombre de morts <br>
            {{ form.nb_victimes_mort(size=18, value=0, class_="form-control") }}
        </div>
        <div class="form-group">
            Nombre de blessés <br>
            {{ form.nb_victimes_blesse(size=18, value=0, class_="form-control") }}
        </div>			
        <div class="form-group">
            Statut du constat <br>
            {{ form.statut(size=1, class_="form-control") }}
        </div>			
        <div class="form-group">
            Nombre de jours agent <br>
            {{ form.nb_jour_agent(size=18,value=0, class_="form-control") }}
        </div>
        
        <input type="hidden"  type="text" name="geomlat" id="geomlat">
        <input type="hidden"  type="text" name="geomlng" id="geomlng">
        <div><button id="subform" type="submit" class="btn btn-primary" disabled>Ajouter le constat</button></div>
    </form>
</div>
</div>
<script>
    var map = L.map('map').setView([44.8, 6.2], 10);
    L.tileLayer('https://a.tile.opentopomap.org/{z}/{x}/{y}.png', {
	    attribution: 'Map data: &copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors, SRTM | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (CC-BY-SA)'
        }).addTo(map); 
	var marker;
	
	var addConstat=function(e){
		if(marker!=undefined){
            map.removeLayer(marker)	
		}
        marker = L.marker(e.latlng)
        marker.addTo(map);
        marker.bindPopup("Vous placez un constat ici").openPopup();		
		document.getElementById("geomlat").value = e.latlng.lat;
        document.getElementById("geomlng").value = e.latlng.lng;
		document.getElementById("subform").disabled=false;
	}
	map.on("click",addConstat);
</script>
{% endblock %}
